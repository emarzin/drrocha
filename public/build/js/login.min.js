$(document).ready(function() {
    function setCredentials(data) {
        storage.set({
            user: data.user
        }), storage.set({
            token: data.token
        }), storage.set({
            member: data.user.email
        }), $.ajaxSetup({
            headers: {
                Authorization: data.token
            }
        })
    }
    var storage = Storages.localStorage,
        emailInformed = function() {
            var hash, vars = [],
                q = decodeURIComponent(document.URL);
            if (void 0 !== (q = q.split("?")[1])) {
                q = q.split("&");
                for (var i = 0; i < q.length; i++) hash = q[i].split("="), vars.push(hash[1]), vars[hash[0]] = hash[1]
            }
            return vars
        }().email;
    void 0 !== emailInformed && $("#email").val(emailInformed), $("#forgotlink").click(function() {
        window.location.href = "/forgot?email=" + $("#email").val()
    }), $("#btnLoginSpinner").hide(), $("#btnLoginLabel").text("Entrar"), $("#btnLogin").click(function() {
        $("#errEmail").text(""), $("#btnLogin").prop("disabled", !0), $("#btnLoginLabel").text("Entrando"), $("#btnLoginSpinner").show();
        var login_data = {
                email: $("#email").val(),
                password: $("#password").val()
            },
            login = $.ajax({
                url: "/api/login",
                type: "POST",
                data: login_data
            });
        login.done(function(data) {
            setCredentials(data), window.location.href = "/members?token=" + data.token
        }), login.fail(function(xhr, textStatus) {
            xhr.responseJSON ? console.log(xhr.responseJSON) : $("#errEmail").text(xhr.responseText), $("#btnLoginSpinner").hide(), $("#btnLoginLabel").text("Entrar"), $("#btnLogin").prop("disabled", !1)
        })
    })
});